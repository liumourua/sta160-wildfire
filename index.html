<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GRU & Hazard RNN — Wildfire Time Series</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f7f7f7;
      color: #222;
    }
    header {
      background: #1f2933;
      color: #fff;
      padding: 18px 20px;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
    }
    header p {
      margin: 6px 0 0;
      font-size: 14px;
      opacity: 0.85;
    }
    main {
      max-width: 980px;
      margin: 20px auto 40px;
      padding: 0 16px 40px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border-radius: 8px;
    }
    h2, h3 {
      margin-top: 28px;
    }
    p {
      line-height: 1.6;
      font-size: 14px;
    }
    .nav-links {
      margin: 12px 0 24px;
      padding-left: 18px;
      font-size: 14px;
    }
    .nav-links a {
      color: #2563eb;
      text-decoration: none;
    }
    .nav-links a:hover {
      text-decoration: underline;
    }
    .panel {
      margin: 26px 0 40px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e5e5e5;
    }
    .panel:last-of-type {
      border-bottom: none;
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      margin-bottom: 8px;
    }
    .panel-header h3 {
      margin: 0;
    }
    .panel-header a {
      font-size: 13px;
      color: #2563eb;
      text-decoration: none;
      white-space: nowrap;
    }
    .panel-header a:hover {
      text-decoration: underline;
    }
    iframe {
      width: 100%;
      height: 420px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fafafa;
    }
    .footnote {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }
    .tag {
      display: inline-block;
      padding: 2px 6px;
      font-size: 11px;
      border-radius: 999px;
      background: #e5e7eb;
      margin-left: 6px;
    }
    code {
      font-family: Consolas, Menlo, Monaco, monospace;
      font-size: 12px;
      background: #f3f4f6;
      padding: 1px 4px;
      border-radius: 3px;
    }
  </style>
</head>
<body>

<header>
  <h1>GRU-based ignition model & hazard RNN</h1>
  <p>
    Short-term wildfire ignition forecasting (GRU + spatial prior) and post-fire hazard analysis
    across U.S. regions from 2013–2025.
  </p>
</header>

<main>

  <!-- 简单目录 -->
  <div class="nav-links">
    Jump to:
    <a href="#methods">Methods</a> ·
    <a href="#results">Results</a> ·
    <a href="#gru-pr">Region PR curves</a> ·
    <a href="#gru-summary">GRU summary</a> ·
    <a href="#operating">Operating points</a> ·
    <a href="#delta">Prior vs no-prior</a> ·
    <a href="#haz-wait">Waiting times</a> ·
    <a href="#haz-cum">Re-ignition probability</a>
  </div>

  <!-- Methods 摘要 -->
  <section id="methods">
    <h2>Methods (time series & models)</h2>

    <h3>Data processing and time series setup</h3>
    <p>
      We represent the study area on a regular grid so that fires can be tracked at fixed sites:
      each 10–15 km² cell has its own daily time series with a wildfire indicator in {0,1} and
      gridded weather and fuel covariates. All inputs use information available on or before
      day <em>t</em>. For each site-day we constructed history-safe predictors, including 1-day
      lags of key variables, 7–30 day rolling means, totals and extremes, and a 30-day “dryness”
      counter (number of days without rain).
    </p>
    <p>
      Because some region–latitude bands contain very few fires, we run all analyses separately for
      each band but also report results for three pooled “combined” bands to stabilise estimates:
      NorthEast_NorthBand (NorthEast_FarNorth + NorthEast_North), East_NorthBand (East_FarNorth +
      East_North), and CentralWest_Mid+South (Central West_Mid + Central West_South). The original
      sub-regions are still modelled and reported individually.
    </p>

    <h3>Learned ignition prior</h3>
    <p>
      To obtain a learned ignition prior, we trained a CatBoost classifier in an expanding-window
      fashion: earlier years are used to predict later years, and for each grid-day we compute an
      out-of-fold ignition probability that respects temporal order. From this prior we derive
      several summary features—the logit transform of the prior score, its within-day rank among
      cells, short lags, and 7-day rolling summaries—which are concatenated with the physical
      covariates and fed into the GRU model. The post-fire hazard analysis uses only days with
      wildfires and excludes these covariates.
    </p>

    <h3>Short-term ignition prediction (GRU + prior)</h3>
    <p>
      The GRU model aims to estimate the probability that at least one new fire occurs in the next
      <em>k</em> days, with horizons k = 7 and k = 14. For each site and each day t with no fire
      (Wildfire<sub>t</sub> = 0), the GRU input is the previous 28 days of engineered features and
      prior features, and the label is 1 if there is a fire on any day in [t+1, t+k]. We use strict
      temporal splits by label year: 2013–2021 for training, 2022 for validation, and 2023–2025
      for testing, and exclude labels within 7 days of the year boundaries to reduce dependence
      between splits.
    </p>
    <p>
      We use a single-layer GRU with a sigmoid output and optimize a weighted binary cross-entropy
      loss to address class imbalance. Early stopping is based on validation PR-AUC, and we apply
      temperature scaling on the validation set to calibrate probabilities. Evaluation metrics on
      the held-out test set include PR and ROC curves, Brier score, reliability diagrams, and
      cumulative gain/lift curves. For operational use, we sweep two decision rules: (i) a
      fixed-precision threshold (e.g. 30% precision) and (ii) a Top-K rule that flags only the
      highest-risk 0.1–0.2% of grid-days for patrol or resource allocation.
    </p>

    <h3>Post-fire hazard (re-ignition) analysis</h3>
    <p>
      To avoid counting a single fire episode over several days, we apply a cooldown window of
      D = 3 days: ignitions closer than D days are merged into one event. For each site we then
      compute waiting times (days) between consecutive fire episodes and right-censor very long
      gaps at 60 days, reported as a “60+ days” bin. We pool sites within each region × latitude
      band and, in discrete time with 1-day steps, form risk-set counts. From these we estimate
      discrete-time hazards, survival S(t), and the cumulative re-ignition probability
      F(T) = P(T ≤ T), which are used to construct regional cumulative hazard curves and summary
      statistics (e.g. median inter-fire gaps and P(T ≤ 7, 14, 30, 60)).
    </p>
  </section>

  <!-- Results 摘要 -->
  <section id="results">
    <h2>Results (GRU & hazard)</h2>

    <h3>GRU ignition model</h3>
    <p>
      With the spatial prior and a 14-day horizon, the GRU model attains consistently strong,
      well-calibrated performance across regions. High- and mid-fire areas rank clearly above
      low-fire regions in calibrated PR-AUC. West_Mid, West_North, and Coast_Mid are among the
      strongest regions, whereas low-fire areas such as Central_West_South show lower, noisier
      curves, consistent with scarce positives.
    </p>
    <p>
      Pairing regions one by one at k = 14, adding the prior improves ROC–AUC by roughly
      0.02–0.03 on average and increases precision in the Top-3% of cells in most regions,
      yielding cleaner alert lists at the same alert rate. The two horizons behave similarly
      overall, so we adopt k = 14 as the default and reserve k = 7 for shorter-lead decisions.
    </p>
    <p>
      Using region-specific calibrated operating points, high- and mid-fire regions achieve
      substantially higher precision than low-fire regions at comparable alert rates, often with
      lifts of 2–3 relative to their base rates and roughly 2–3 alerts per captured fire.
      Balanced accuracy remains modest because negatives dominate, but targeted alerting remains
      strong, and many regions still contain high-yield slices despite the class imbalance.
    </p>

    <h3>Hazard RNN (post-fire waiting times)</h3>
    <p>
      The hazard analysis provides a complementary, time-to-event view of fire dynamics. West_Mid
      has the highest activity and the fastest re-ignition cycle, with roughly 35% of sites
      reigniting within 30 days and just over 50% within 60 days. Most other regions cluster
      lower, around 10–25% by 60 days, indicating less frequent and later re-ignition.
    </p>
    <p>
      Median inter-fire waiting times are consistent with these curves: West_Mid sits at the
      short end (weeks to a few months), Midwest_Far_North and West_North in the mid range
      (a few months), and Central_West_North or West_Far_North show very long medians (hundreds
      of days), characteristic of slow background activity. Together with the GRU model, these
      patterns suggest that fast-cycling regions can support shorter horizons and higher alert
      coverage, whereas slow regions warrant more conservative use of alerts.
    </p>
  </section>

  <!-- 交互图 1：按 region 的 PR 曲线 -->
  <section id="gru-pr" class="panel">
    <div class="panel-header">
      <h3>Region PR curves (GRU with prior, k = 14)</h3>
      <a href="gru_pr_curves.html" target="_blank">Open full screen ↗</a>
    </div>
    <p class="footnote">
      Each line is a region × latitude band. Legend entries can be toggled on/off to inspect
      specific regions.
    </p>
    <iframe src="gru_pr_curves.html"></iframe>
  </section>

  <!-- 交互图 2：全局 summary（PR-AUC / ROC-AUC / base rate） -->
  <section id="gru-summary" class="panel">
    <div class="panel-header">
      <h3>Global GRU summary metrics</h3>
      <a href="gru_summary.html" target="_blank">Open full screen ↗</a>
    </div>
    <p class="footnote">
      Summary table derived from <code>gru.csv</code>, including PR-AUC, ROC-AUC, base rate,
      Brier score, and sample counts for each region and horizon.
    </p>
    <iframe src="gru_summary.html"></iframe>
  </section>

  <!-- 交互图 3：Operating points（推荐阈值） -->
  <section id="operating" class="panel">
    <div class="panel-header">
      <h3>Region-specific operating points (k = 14, GRU with prior)</h3>
      <a href="operating_points.html" target="_blank">Open full screen ↗</a>
    </div>
    <p class="footnote">
      For each region, we select a calibrated decision threshold (fixed precision target when
      feasible, otherwise a Top-K rule) and report precision, recall, coverage, and confusion
      matrix counts.
    </p>
    <iframe src="operating_points.html"></iframe>
  </section>

  <!-- 交互图 4：Delta 表（prior vs no_prior） -->
  <section id="delta" class="panel">
    <div class="panel-header">
      <h3>Gain from adding the spatial prior (Top-3% precision, k = 14)</h3>
      <a href="delta_top3.html" target="_blank">Open full screen ↗</a>
    </div>
    <p class="footnote">
      Comparison between GRU_with_prior and GRU_no_prior at the Top-3% selection, by region.
      Positive values indicate cleaner alert lists when using the learned ignition prior.
    </p>
    <iframe src="delta_top3.html"></iframe>
  </section>

  <!-- 交互图 5：Hazard median waiting time -->
  <section id="haz-wait" class="panel">
    <div class="panel-header">
      <h3>Median inter-fire waiting time by region</h3>
      <a href="hazard_waiting.html" target="_blank">Open full screen ↗</a>
    </div>
    <p class="footnote">
      Horizontal bars show the median number of days between consecutive fire episodes in each
      region. Hover for additional statistics such as the number of intervals and P(T ≤ 30).
    </p>
    <iframe src="hazard_waiting.html"></iframe>
  </section>

  <!-- 交互图 6：Hazard 30 / 60 天复燃概率 -->
  <section id="haz-cum" class="panel">
    <div class="panel-header">
      <h3>30- and 60-day re-ignition probability by region</h3>
      <a href="hazard_cumprob.html" target="_blank">Open full screen ↗</a>
    </div>
    <p class="footnote">
      Bars show the estimated probability that a site reignites within 30 or 60 days after the
      last fire, summarised from the hazard analysis.
    </p>
    <iframe src="hazard_cumprob.html"></iframe>
  </section>

</main>

</body>
</html>
