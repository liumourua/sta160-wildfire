<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>STA160 – GRU & Hazard RNN wildfire forecasts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- 简单一点的现代字体 -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">

    <style>
        :root {
            --bg: #0f172a;
            --bg-alt: #020617;
            --card-bg: #111827;
            --accent: #38bdf8;
            --accent-soft: rgba(56, 189, 248, 0.1);
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --border-subtle: #1f2937;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
            color: var(--text-main);
            line-height: 1.6;
        }

        a {
            color: var(--accent);
        }

        header {
            position: sticky;
            top: 0;
            z-index: 20;
            backdrop-filter: blur(16px);
            background: linear-gradient(to right, rgba(15, 23, 42, 0.95), rgba(3, 7, 18, 0.95));
            border-bottom: 1px solid rgba(148, 163, 184, 0.15);
        }

        .nav-inner {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0.75rem 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
        }

        .nav-title {
            font-weight: 600;
            letter-spacing: 0.02em;
            display: flex;
            align-items: baseline;
            gap: 0.4rem;
        }

        .nav-title span.small {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .nav-links {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            font-size: 0.9rem;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-muted);
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            border: 1px solid transparent;
        }

        .nav-links a:hover {
            color: var(--text-main);
            border-color: rgba(148, 163, 184, 0.35);
            background: rgba(15, 23, 42, 0.9);
        }

        main {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1.5rem 1.25rem 3rem;
        }

        section {
            margin-top: 2rem;
        }

        h1, h2, h3 {
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        h1 {
            font-size: 1.9rem;
            margin-bottom: 0.75rem;
        }

        h2 {
            font-size: 1.35rem;
            margin-bottom: 0.4rem;
        }

        h3 {
            font-size: 1.05rem;
            margin: 0 0 0.5rem;
        }

        .lead {
            color: var(--text-muted);
            max-width: 800px;
            font-size: 0.96rem;
        }

        .pill-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-top: 0.75rem;
        }

        .pill {
            font-size: 0.75rem;
            padding: 0.15rem 0.55rem;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            color: #cbd5f5;
            background: rgba(15, 23, 42, 0.85);
        }

        .pill.strong {
            border-color: rgba(56, 189, 248, 0.7);
            background: var(--accent-soft);
            color: #e0f2fe;
        }

        .card-grid-2 {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 1.1rem;
        }

        .card-wide {
            border-radius: 0.9rem;
            padding: 1rem 1.1rem;
            background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), rgba(15, 23, 42, 0.98));
            border: 1px solid rgba(148, 163, 184, 0.3);
            margin-top: 1.1rem;
        }

        .card {
            border-radius: 0.9rem;
            padding: 0.9rem 1rem;
            background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.18), rgba(15, 23, 42, 0.98));
            border: 1px solid rgba(148, 163, 184, 0.25);
        }

        .card p {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 0.15rem;
            margin-bottom: 0.4rem;
        }

        iframe.plot-frame {
            width: 100%;
            height: 430px;
            border: 1px solid var(--border-subtle);
            border-radius: 0.75rem;
            background: #020617;
        }

        .small-note {
            font-size: 0.82rem;
            color: var(--text-muted);
            margin-top: 0.35rem;
        }

        /* 交互选图样式 */

        .control-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
            margin: 0.5rem 0 0.75rem;
        }

        .control-bar label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .control-bar select {
            margin-left: 0.35rem;
            padding: 0.2rem 0.5rem;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            background: #020617;
            color: var(--text-main);
            font-size: 0.85rem;
        }

        .diag-grid {
            display: grid;
            grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
            grid-template-rows: auto auto;
            gap: 0.9rem;
            margin-top: 0.4rem;
        }

        .diag-grid figure {
            margin: 0;
            border-radius: 0.9rem;
            border: 1px solid var(--border-subtle);
            background: #020617;
            padding: 0.4rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .diag-grid img {
            width: 100%;
            border-radius: 0.55rem;
            display: block;
        }

        .diag-grid figcaption {
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        @media (max-width: 900px) {
            .card-grid-2 {
                grid-template-columns: 1fr;
            }

            .diag-grid {
                grid-template-columns: 1fr;
            }

            iframe.plot-frame {
                height: 380px;
            }
        }

        .downloads {
            list-style: none;
            padding-left: 0;
            font-size: 0.9rem;
        }

        .downloads li {
            margin-bottom: 0.25rem;
        }

        footer {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1rem 1.25rem 2rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
    </style>
</head>

<body>
<header>
    <div class="nav-inner">
        <div class="nav-title">
            <span>Wildfire GRU & hazard RNN</span>
            <span class="small">STA160 project</span>
        </div>
        <nav class="nav-links">
            <a href="#overview">Overview</a>
            <a href="#gru">GRU performance</a>
            <a href="#diag">Per-region diagnostics</a>
            <a href="#hazard">Post-fire hazard</a>
            <a href="#tables">Download tables</a>
        </nav>
    </div>
</header>

<main>
    <!-- 概览 -->
    <section id="overview">
        <h1>Short-term wildfire ignition forecasts</h1>
        <p class="lead">
            We use a GRU-based ignition model with a learned spatial prior and a discrete-time hazard
            RNN to forecast where and when wildfires are likely to ignite or re-ignite across CONUS.
            This page summarises the main model results and provides interactive views by region.
        </p>
        <div class="pill-row">
            <span class="pill strong">GRU + CatBoost ignition prior</span>
            <span class="pill">Horizons k = 7 &amp; 14 days</span>
            <span class="pill">Region × latitude bands</span>
            <span class="pill">Post-fire re-ignition hazards</span>
        </div>
    </section>

    <!-- GRU 全局表现 -->
    <section id="gru">
        <h2>GRU performance across regions</h2>
        <p class="small-note">
            The plots below use the test-set predictions (2013–2025 labels) with temperature-scaled probabilities.
            They summarise calibration, ranking quality, and recommended operating points.
        </p>

        <div class="card-grid-2">
            <div class="card">
                <h3>Region-wise PR-AUC / ROC-AUC (k=7 vs k=14)</h3>
                <p>Compare performance across all region–latitude bands and between the two horizons.</p>
                <iframe class="plot-frame" src="gru_summary.html"></iframe>
            </div>

            <div class="card">
                <h3>PR curves overlay by region (k=14, with prior)</h3>
                <p>Interactive precision–recall curves; use the legend to toggle individual regions.</p>
                <iframe class="plot-frame" src="gru_pr_curves.html"></iframe>
            </div>
        </div>

        <div class="card-grid-2" style="margin-top: 1.1rem;">
            <div class="card">
                <h3>Recommended operating points (k=14, with prior)</h3>
                <p>Fixed-precision thresholds or Top-K rules for each region with ~30% precision when feasible.</p>
                <iframe class="plot-frame" src="operating_points.html"></iframe>
            </div>

            <div class="card">
                <h3>Gain from adding the ignition prior</h3>
                <p>Change in Top-3% precision when we switch from GRU without prior to GRU with prior,
                   for both k=7 and k=14.</p>
                <iframe class="plot-frame" src="delta_top3.html"></iframe>
            </div>
        </div>
    </section>

    <!-- 交互：单一区域诊断图 -->
    <section id="diag">
        <h2>Per-region diagnostics viewer</h2>
        <div class="card-wide">
            <p class="small-note">
                Use the controls to explore detailed diagnostics for one region at a time. For each configuration
                we show three groups of plots: PR/ROC/reliability, score distributions, and gain &amp; lift curves.
            </p>

            <div class="control-bar">
                <label>
                    Region × band
                    <select id="regionSelect">
                        <!-- TODO: 把下面这些值改成你真的有图片的 tag，必须和文件名前缀完全一致 -->
                        <option value="West_Mid" selected>West_Mid</option>
                        <option value="West_North">West_North</option>
                        <option value="Coast_Mid">Coast_Mid</option>
                        <option value="CentralWest_FarNorth">CentralWest_FarNorth</option>
                        <option value="CentralWest_Mid">CentralWest_Mid</option>
                        <option value="CentralWest_South">CentralWest_South</option>
                        <!-- 需要更多地区就继续加 option -->
                    </select>
                </label>

                <label>
                    Horizon k
                    <select id="horizonSelect">
                        <option value="7">k = 7 days</option>
                        <option value="14" selected>k = 14 days</option>
                    </select>
                </label>

                <label>
                    Prior
                    <select id="priorSelect">
                        <option value="with_prior" selected>with spatial prior</option>
                        <option value="no_prior">no prior</option>
                    </select>
                </label>
            </div>

            <div class="diag-grid">
                <figure>
                    <img id="img-pr-roc" alt="PR, ROC and reliability curves">
                    <figcaption>PR curve, ROC curve, and reliability diagram for the selected setting.</figcaption>
                </figure>

                <figure>
                    <img id="img-score" alt="Score histogram">
                    <figcaption>Score distribution for negatives vs positives (calibrated scores).</figcaption>
                </figure>

                <figure>
                    <img id="img-gain" alt="Cumulative gain and lift curves">
                    <figcaption>Cumulative gain and lift curves as we move down the ranked list of cells.</figcaption>
                </figure>
            </div>

            <p class="small-note">
                The images are loaded directly from pre-computed PNGs in the repository
                (one set per region, horizon, and prior setting).
            </p>
        </div>
    </section>

    <!-- Hazard 结果 -->
    <section id="hazard">
        <h2>Post-fire hazard (re-ignition) analysis</h2>
        <p class="small-note">
            These plots summarise how quickly sites tend to re-ignite after a fire in each region × latitude band.
        </p>

        <div class="card-grid-2">
            <div class="card">
                <h3>Median inter-fire waiting time</h3>
                <p>Regions with short medians and high activity form the fast-cycling hazard tier.</p>
                <iframe class="plot-frame" src="hazard_waiting.html"></iframe>
            </div>

            <div class="card">
                <h3>30- and 60-day re-ignition probability</h3>
                <p>For each region we show the cumulative probability of re-ignition within 30 and 60 days.</p>
                <iframe class="plot-frame" src="hazard_cumprob.html"></iframe>
            </div>
        </div>
    </section>

    <!-- 下载链接 -->
    <section id="tables">
        <h2>Download summary tables</h2>
        <div class="card">
            <ul class="downloads">
                <li><a href="data/gru.csv">gru.csv – GRU summary metrics by region / model / horizon</a></li>
                <li><a href="data/delta_k14.csv">delta_k14.csv – Top-k precision gain with prior (k=14)</a></li>
                <li><a href="data/delta_k7.csv">delta_k7.csv – Top-k precision gain with prior (k=7)</a></li>
                <li><a href="data/operating_k14.csv">operating_k14.csv – k=14 calibrated operating points</a></li>
                <li><a href="data/operating_k7.csv">operating_k7.csv – k=7 calibrated operating points</a></li>
                <li><a href="data/hazard.csv">hazard.csv – Post-fire hazard summary by region</a></li>
            </ul>
            <p class="small-note">
                All tables are computed on the held-out test period with strict temporal splits.
            </p>
        </div>
    </section>
</main>

<footer>
    AI assistance: large language models were used to help write GRU / hazard-RNN code,
    generate summary plots, and draft parts of the text on this page. All results were
    checked and interpreted by the authors.
</footer>

<script>
    // ====== 交互选图脚本 ======
    // 假设所有 PNG 都放在 repo 的 figs/gru_region/ 目录下
    const IMG_BASE = "figs/gru_region/";

    function updateDiagImages() {
        const region = document.getElementById("regionSelect").value;
        const k      = document.getElementById("horizonSelect").value;   // "7" or "14"
        const prior  = document.getElementById("priorSelect").value;     // "with_prior" / "no_prior"

        // 文件名格式：<Tag>_k7_GRU_with_prior_pr_roc_reliability.png
        const base = `${region}_k${k}_GRU_${prior}`;

        document.getElementById("img-pr-roc").src =
            IMG_BASE + base + "_pr_roc_reliability.png";

        document.getElementById("img-score").src =
            IMG_BASE + base + "_score_hist.png";

        document.getElementById("img-gain").src =
            IMG_BASE + base + "_gain_lift.png";
    }

    document.getElementById("regionSelect").addEventListener("change", updateDiagImages);
    document.getElementById("horizonSelect").addEventListener("change", updateDiagImages);
    document.getElementById("priorSelect").addEventListener("change", updateDiagImages);

    // 初始加载一次
    updateDiagImages();
</script>
</body>
</html>
