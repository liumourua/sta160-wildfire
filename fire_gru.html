<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GRU & Hazard ‚Äì Wildfire Ignition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ========= ÁÆÄÂçïÊµÖËâ≤Á≥ªÊ†∑Âºè ========= -->
  <style>
    :root {
      --bg: #f6f8fc;
      --bg-card: #ffffff;
      --accent: #2563eb;
      --accent-soft: #e0ebff;
      --accent-dark: #1d4ed8;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-subtle: #e5e7eb;
      --shadow-soft: 0 16px 40px rgba(15,23,42,0.08);
      --radius-card: 14px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      line-height: 1.6;
    }

    a {
      color: var(--accent-dark);
    }

    /* È°∂ÈÉ® hero */

    .hero {
      background: radial-gradient(circle at top left, #fca5a5, transparent 55%),
                  radial-gradient(circle at top right, #fde68a, transparent 55%),
                  linear-gradient(135deg, #eff6ff, #f9fafb);
      padding: 32px 24px 20px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .hero-inner {
      max-width: 1100px;
      margin: 0 auto;
    }

    .hero-title {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.03em;
      margin-bottom: 4px;
    }

    .hero-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .hero-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(37,99,235,0.06);
      font-size: 12px;
      color: var(--accent-dark);
      border: 1px solid rgba(37,99,235,0.12);
      margin-bottom: 8px;
    }

    .hero-pill span.emoji {
      font-size: 14px;
    }

    .hero-nav {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 14px;
    }

    .hero-nav a {
      padding: 6px 10px;
      border-radius: 999px;
      background: #ffffff;
      border: 1px solid var(--border-subtle);
      text-decoration: none;
      color: var(--text-muted);
    }

    .hero-nav a:hover {
      border-color: var(--accent);
      color: var(--accent-dark);
    }

    /* ‰∏ª‰ΩìÂ∏ÉÂ±Ä */

    .page {
      max-width: 1100px;
      margin: 20px auto 40px;
      padding: 0 16px 40px;
    }

    section {
      margin-bottom: 32px;
    }

    h2 {
      font-size: 22px;
      margin-bottom: 10px;
    }

    h3 {
      font-size: 18px;
      margin-bottom: 8px;
    }

    p {
      margin-bottom: 8px;
      font-size: 14px;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-soft);
      padding: 18px 20px;
      border: 1px solid rgba(148,163,184,0.25);
      margin-bottom: 18px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .card-title {
      font-weight: 600;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-dark);
      border: 1px solid rgba(37,99,235,0.24);
    }

    .muted {
      color: var(--text-muted);
      font-size: 13px;
    }

    /* iframe Âå∫Âùó */

    .iframe-row {
      display: grid;
      grid-template-columns: minmax(0,1.6fr) minmax(0,1.2fr);
      gap: 16px;
    }

    .iframe-row iframe,
    .iframe-full iframe {
      width: 100%;
      height: 380px;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: #fff;
    }

    .iframe-full iframe {
      height: 420px;
    }

    @media (max-width: 900px) {
      .iframe-row {
        grid-template-columns: 1fr;
      }
      .iframe-row iframe,
      .iframe-full iframe {
        height: 320px;
      }
    }

    /* per-region viewer */

    .viewer-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 18px;
      margin-bottom: 12px;
      align-items: center;
      font-size: 14px;
    }

    .control-group {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    select {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      font-size: 13px;
      color: var(--text-main);
    }

    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37,99,235,0.25);
    }

    .viewer-grid {
      display: grid;
      grid-template-columns: minmax(0,1.4fr) minmax(0,1.1fr);
      gap: 14px;
      margin-top: 6px;
    }

    .viewer-item {
      background: #f9fafb;
      border-radius: 12px;
      padding: 10px 10px 14px;
      border: 1px solid #e5e7eb;
    }

    .viewer-item h4 {
      font-size: 13px;
      margin-bottom: 4px;
    }

    .viewer-item p {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .viewer-item img {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      display: block;
      background: #fff;
    }

    @media (max-width: 900px) {
      .viewer-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Â∞èÊèêÁ§∫ */

    .note {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

  </style>
</head>

<body>

  <!-- ================= Hero Â§¥ÈÉ® ================= -->
  <header class="hero">
    <div class="hero-inner">
      <div class="hero-pill">
        <span class="emoji">üî•</span>
        <span>GRU ignition model & post-fire hazard</span>
      </div>
      <h1 class="hero-title">Short-term wildfire ignition & re-ignition</h1>
      <p class="hero-subtitle">
        Region-specific GRU forecasts with a learned spatial prior, combined with a hazard-style
        analysis of time to re-ignition.
      </p>

      <nav class="hero-nav">
        <a href="#summary">Overview</a>
        <a href="#interactive">Interactive summaries</a>
        <a href="#viewer">Per-region diagnostics</a>
        <a href="#methods">Methods</a>
      </nav>
    </div>
  </header>

  <main class="page">

    <!-- ================= Overview ================= -->
    <section id="summary">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span>High-level findings</span>
            <span class="pill">GRU + hazard RNN</span>
          </div>
        </div>
        <p>
          With a 14-day horizon and a learned ignition prior, the GRU model achieves
          consistent calibrated performance across regions. High- and mid-fire regions
          sit clearly above low-fire regions in calibrated PR-AUC and gain curves.
          Adding the spatial prior improves ROC-AUC by about 0.02‚Äì0.03 on average and
          typically raises Top-3% precision by 0.03‚Äì0.08, yielding cleaner, more
          targeted alert lists.
        </p>
        <p>
          The post-fire hazard analysis provides a complementary time-to-event view.
          Fast-cycling regions such as <em>West_Mid</em> have around 35% probability of
          re-ignition within 30 days and just over 50% within 60 days, while most other
          regions cluster around 10‚Äì25% by 60 days. These patterns motivate using higher
          alert coverage and shorter horizons in fast-cycling bands, and more conservative
          alerting in slow-cycling regions.
        </p>
      </div>
    </section>

    <!-- ================= Interactive summaries (Plotly iframes) ================= -->
    <section id="interactive">
      <h2>Interactive summaries</h2>

      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span>Global GRU performance</span>
          </div>
          <span class="muted">Hover to inspect individual regions</span>
        </div>

        <div class="iframe-row">
          <div>
            <h3 style="font-size:14px;margin-bottom:4px;">Precision‚Äìrecall curves by region</h3>
            <p class="muted" style="margin-bottom:6px;">
              Overlay of calibrated PR curves for all regions at horizon k = 14 (with spatial prior).
              Use the legend to toggle individual bands.
            </p>
            <iframe src="gru_pr_curves.html" loading="lazy"></iframe>
          </div>
          <div>
            <h3 style="font-size:14px;margin-bottom:4px;">Summary metrics (PR-AUC, ROC-AUC, base rates)</h3>
            <p class="muted" style="margin-bottom:6px;">
              Table-style view summarizing GRU performance per region and horizon.
            </p>
            <iframe src="gru_summary.html" loading="lazy"></iframe>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span>Operating points & prior gains</span>
          </div>
        </div>
        <div class="iframe-row">
          <div>
            <h3 style="font-size:14px;margin-bottom:4px;">Recommended operating points (k = 14, with prior)</h3>
            <p class="muted" style="margin-bottom:6px;">
              For each region we choose thresholds that roughly target 30% precision
              or a Top-K rule, and report the resulting alert rates, recall, and lift.
            </p>
            <iframe src="operating_points.html" loading="lazy"></iframe>
          </div>
          <div>
            <h3 style="font-size:14px;margin-bottom:4px;">Top-3% precision gains from the spatial prior</h3>
            <p class="muted" style="margin-bottom:6px;">
              Comparison of Top-3% precision with and without the learned ignition prior,
              at horizon k = 7 and k = 14.
            </p>
            <iframe src="delta_top3.html" loading="lazy"></iframe>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span>Post-fire hazard summaries</span>
          </div>
        </div>
        <div class="iframe-row">
          <div>
            <h3 style="font-size:14px;margin-bottom:4px;">Median inter-fire waiting time</h3>
            <p class="muted" style="margin-bottom:6px;">
              Regions are sorted from shortest to longest median gap between fires.
            </p>
            <iframe src="hazard_waiting.html" loading="lazy"></iframe>
          </div>
          <div>
            <h3 style="font-size:14px;margin-bottom:4px;">30- and 60-day re-ignition probability</h3>
            <p class="muted" style="margin-bottom:6px;">
              Cumulative probability that a site reignites within 30 or 60 days
              after the last fire.
            </p>
            <iframe src="hazard_cumprob.html" loading="lazy"></iframe>
          </div>
        </div>
      </div>
    </section>

    <!-- ================= Per-region diagnostics viewer ================= -->
    <section id="viewer">
      <h2>Per-region diagnostics viewer</h2>

      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span>Explore diagnostics for one region √ó latitude band</span>
          </div>
        </div>
        <p class="muted" style="margin-bottom:10px;">
          Use the controls below to select a region, latitude band, forecast horizon, and
          whether the GRU uses the spatial ignition prior. For each configuration we display
          three sets of plots: PR/ROC/reliability curves, score distributions, and cumulative
          gain &amp; lift curves. Images are loaded from pre-computed PNGs in the repository
          (<code>figs/gru_region/</code>).
        </p>

        <div class="viewer-controls">
          <div class="control-group">
            <span>Region:</span>
            <select id="regionSelect"></select>
          </div>

          <div class="control-group">
            <span>Lat&nbsp;zone:</span>
            <select id="latSelect"></select>
          </div>

          <div class="control-group">
            <span>Horizon k:</span>
            <select id="kSelect">
              <option value="7">k = 7 days</option>
              <option value="14" selected>k = 14 days</option>
            </select>
          </div>

          <div class="control-group">
            <span>Prior:</span>
            <select id="priorSelect">
              <option value="with_prior" selected>with spatial prior</option>
              <option value="no_prior">no prior</option>
            </select>
          </div>
        </div>

        <div class="viewer-grid">
          <div class="viewer-item">
            <h4>PR, ROC and reliability curves</h4>
            <p>PR curve, ROC curve, and reliability diagram for the selected configuration.</p>
            <img id="imgPrRoc" src="" alt="PR / ROC / reliability curves" />
          </div>

          <div class="viewer-item">
            <h4>Score histogram</h4>
            <p>Score distribution for negatives vs positives (calibrated scores).</p>
            <img id="imgHist" src="" alt="Score histogram" />
          </div>

          <div class="viewer-item" style="grid-column: 1 / -1;">
            <h4>Cumulative gain and lift curves</h4>
            <p>Cumulative gain and lift as we move down the ranked list of cells.</p>
            <img id="imgGainLift" src="" alt="Gain and lift curves" />
          </div>
        </div>

        <p class="note">
          File naming convention expected by the viewer:
          <code>&lt;Tag&gt;_k7_GRU_with_prior_pr_roc_reliability.png</code>,
          <code>&lt;Tag&gt;_k7_GRU_with_prior_score_hist.png</code>,
          <code>&lt;Tag&gt;_k7_GRU_with_prior_gain_lift.png</code>, and similarly for
          <code>k14</code> and <code>no_prior</code>. The <code>&lt;Tag&gt;</code> values are
          specified in the JavaScript configuration below.
        </p>
      </div>
    </section>

    <!-- ================= Methods (ÁÆÄÁü≠Áâà) ================= -->
    <section id="methods">
      <h2>Methods (summary)</h2>

      <div class="card">
        <h3>Time-series setup & ignition model</h3>
        <p>
          We work on a 10‚Äì15 km grid so that fires can be tracked at fixed sites. Each cell has its
          own daily time series with a wildfire indicator in {0,1} and gridded weather and fuel
          covariates, all restricted to information available on or before day <em>t</em>. For each
          site-day we construct history-safe predictors such as 1-day lags, 7‚Äì30 day rolling means,
          totals and extremes, and a 30-day ‚Äúdryness‚Äù counter (days without rain). Because some
          region‚Äìlatitude bands contain very few fires, we analyse each band separately and also
          report results for three pooled ‚Äúcombined‚Äù bands to stabilise estimates.
        </p>
        <p>
          To obtain a learned ignition prior, we train a CatBoost classifier in an expanding-window
          fashion: earlier years predict later years, and we compute an out-of-fold ignition
          probability for each grid-day. From this we derive summary features (logit of the prior,
          within-day rank among cells, short lags, 7-day rolling summaries), which are concatenated
          with the physical covariates and fed into a single-layer GRU. The GRU predicts the
          probability that at least one new fire occurs in the next <em>k</em> days (k = 7 or 14)
          using the previous 28 days of features; we use strict temporal splits by label year and
          optimise a weighted cross-entropy loss with early stopping on validation PR-AUC. Final
          probabilities are temperature-scaled for calibration.
        </p>
      </div>

      <div class="card">
        <h3>Post-fire hazard analysis</h3>
        <p>
          For the hazard RNN, we merge ignitions within a D = 3 day cooldown window into single
          events, compute waiting times between episodes, and right-censor gaps beyond 60 days. We
          then estimate discrete-time hazards and survival curves for each region √ó latitude band,
          yielding cumulative re-ignition probabilities P(T ‚â§ d) and summary statistics such as
          median gaps and probability of re-ignition within 7, 14, 30, and 60 days. These estimates
          are used to define fast-, mid-, and slow-cycling hazard tiers and to interpret GRU
          operating points in terms of local re-ignition dynamics.
        </p>
      </div>
    </section>

  </main>
<!-- image fullscreen overlay -->
<div id="imgFs"><button class="close">Close (Esc)</button><img alt=""></div>


  <!-- ================= JSÔºöRegion / Lat zone ÈÄâÊã© & ÂõæÁâáÂàáÊç¢ ================= -->
  <script>
    // ÈÖçÁΩÆÔºöregion + lat_zone + tagÔºàtag Áî®Êù•ÊãºÂõæÁâáÊñá‰ª∂ÂêçÔºâ
    // ËøôÈáåÂÖàÂàóÂá∫Â∏∏Áî®ÁöÑ‰∏Ä‰∫õÔºõ‰Ω†ÂèØ‰ª•ÊåâÈúÄË¶ÅË°•ÂÖ®„ÄÇ
    const REGION_LAT_CONFIG = [
      { tag: "West_Mid",              region: "West",          lat: "Mid" },
      { tag: "West_North",            region: "West",          lat: "North" },
      { tag: "West_FarNorth",         region: "West",          lat: "Far North" },

      { tag: "Coast_Mid",             region: "Coast",         lat: "Mid" },
      { tag: "Coast_North",           region: "Coast",         lat: "North" },
      { tag: "Coast_South",           region: "Coast",         lat: "South" },
      { tag: "Coast_FarNorth",        region: "Coast",         lat: "Far North" },

      { tag: "East_Mid",              region: "East",          lat: "Mid" },
      { tag: "East_North",            region: "East",          lat: "North" },
      { tag: "East_South",            region: "East",          lat: "South" },
      { tag: "East_FarNorth",         region: "East",          lat: "Far North" },
      { tag: "East_NorthBand",        region: "East",          lat: "NorthBand (combined)" },

      { tag: "NorthEast_North",       region: "NorthEast",     lat: "North" },
      { tag: "NorthEast_FarNorth",    region: "NorthEast",     lat: "Far North" },
      { tag: "NorthEast_NorthBand",   region: "NorthEast",     lat: "NorthBand (combined)" },

      { tag: "Midwest_Mid",           region: "Midwest",       lat: "Mid" },
      { tag: "Midwest_North",         region: "Midwest",       lat: "North" },
      { tag: "Midwest_South",         region: "Midwest",       lat: "South" },
      { tag: "Midwest_FarNorth",      region: "Midwest",       lat: "Far North" },

      { tag: "CentralWest_Mid",       region: "Central West",  lat: "Mid" },
      { tag: "CentralWest_North",     region: "Central West",  lat: "North" },
      { tag: "CentralWest_South",     region: "Central West",  lat: "South" },
      { tag: "CentralWest_FarNorth",  region: "Central West",  lat: "Far North" },
      { tag: "CentralWest_Mid+South_COMBINED", region: "Central West", lat: "Mid+South (combined)" }
    ];

    const regionSelect = document.getElementById("regionSelect");
    const latSelect    = document.getElementById("latSelect");
    const kSelect      = document.getElementById("kSelect");
    const priorSelect  = document.getElementById("priorSelect");

    const imgPrRoc    = document.getElementById("imgPrRoc");
    const imgHist     = document.getElementById("imgHist");
    const imgGainLift = document.getElementById("imgGainLift");

    // Â°´ÂÖÖ Region ‰∏ãÊãâÊ°Ü
    const uniqueRegions = [...new Set(REGION_LAT_CONFIG.map(d => d.region))].sort();
    uniqueRegions.forEach(r => {
      const opt = document.createElement("option");
      opt.value = r;
      opt.textContent = r;
      regionSelect.appendChild(opt);
    });

    // Ê†πÊçÆ Region Êõ¥Êñ∞ Lat zone ‰∏ãÊãâÊ°Ü
    function updateLatOptions() {
      const region = regionSelect.value;
      latSelect.innerHTML = "";
      const lats = REGION_LAT_CONFIG
        .filter(d => d.region === region)
        .map(d => d.lat);
      const uniqueLats = [...new Set(lats)];
      uniqueLats.forEach(l => {
        const opt = document.createElement("option");
        opt.value = l;
        opt.textContent = l;
        latSelect.appendChild(opt);
      });
    }

    // Ê†πÊçÆ region + lat ÊâæÂà∞ tag
    function currentTag() {
      const region = regionSelect.value;
      const lat    = latSelect.value;
      const entry = REGION_LAT_CONFIG.find(
        d => d.region === region && d.lat === lat
      );
      return entry ? entry.tag : null;
    }

    // Êõ¥Êñ∞‰∏âÂº†ÂõæÁâáÂú∞ÂùÄ
    function updateImages() {
      const tag = currentTag();
      const k = kSelect.value;               // "7" Êàñ "14"
      const prior = priorSelect.value;       // "with_prior" / "no_prior"

      if (!tag) {
        imgPrRoc.alt    = "No configuration found";
        imgHist.alt     = "No configuration found";
        imgGainLift.alt = "No configuration found";
        imgPrRoc.src = imgHist.src = imgGainLift.src = "";
        return;
      }

      const basePath = "figs/gru_region/";
      imgPrRoc.src    = `${basePath}${tag}_k${k}_GRU_${prior}_pr_roc_reliability.png`;
      imgHist.src     = `${basePath}${tag}_k${k}_GRU_${prior}_score_hist.png`;
      imgGainLift.src = `${basePath}${tag}_k${k}_GRU_${prior}_gain_lift.png`;
    }

    // ‰∫ã‰ª∂ÁªëÂÆö
    regionSelect.addEventListener("change", () => {
      updateLatOptions();
      updateImages();
    });

    latSelect.addEventListener("change", updateImages);
    kSelect.addEventListener("change", updateImages);
    priorSelect.addEventListener("change", updateImages);

    // ÂàùÂßãÁä∂ÊÄÅÔºöÈÄâÁ¨¨‰∏Ä‰∏™ region & lat
    if (uniqueRegions.length > 0) {
      regionSelect.value = uniqueRegions[0];
      updateLatOptions();
      updateImages();
    }
  </script>

<script>
// Image zoom overlay for per-region PNGs
(function(){
  const fs = document.getElementById('imgFs');
  if(!fs) return;
  const img = fs.querySelector('img');
  function openImg(src){ img.src = src; fs.style.display='flex'; }
  function closeImg(){ img.src=''; fs.style.display='none'; }
  fs.querySelector('.close').onclick = closeImg;
  fs.addEventListener('click', (e)=>{ if(e.target===fs) closeImg(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeImg(); });
  // Bind click on images in the per-region panel
  ['imgA','imgB','imgC'].forEach(id=>{
    const el = document.getElementById(id);
    if(el){ el.addEventListener('click', ()=> openImg(el.src)); }
  });
})();
</script>
</body>
</html>
