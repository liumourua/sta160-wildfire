<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wildfire | GRU + Hazard RNN â€” Interactive Report</title>
  <meta name="description" content="GRU ignition forecasting (k=7/14) with spatial prior + hazard RNN. History-safe features; region Ã— latitude-band diagnostics; interactive summaries." />
  <style>
    :root{
      --bg:#f9fafb; --panel:#ffffff; --ink:#111827; --ink-2:#4b5563; --muted:#9ca3af; --accent:#2563eb; --soft:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      position:sticky;top:0;z-index:10;background:rgba(249,250,251,0.92);backdrop-filter:saturate(160%) blur(8px);
      border-bottom:1px solid var(--soft);
    }
    .wrap{max-width:1180px;margin:0 auto;padding:0 16px}
    .nav{display:flex;align-items:center;justify-content:space-between;height:56px}
    .nav h1{font-size:18px;margin:0}
    .nav ul{list-style:none;margin:0;padding:0;display:flex;gap:14px}
    .nav li a{display:inline-block;padding:6px 8px;border-radius:8px}
    .nav li a:hover{background:#eef2ff}
    section{padding:22px 0;border-top:1px solid var(--soft)}
    h2{margin:0 0 12px 0;font-size:24px}
    h3{margin:0 0 10px 0;font-size:20px}
    .muted{color:var(--ink-2)}
    .small{font-size:12px;color:var(--muted)}
    .hero{padding:26px 0 8px 0}
    .pill{display:inline-block;padding:2px 8px;border:1px solid var(--soft);border-radius:999px;font-size:12px;margin-right:6px;background:#fff}
    .grid{display:grid;gap:14px}
    .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:980px){.grid.cols-2{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid var(--soft);border-radius:12px;padding:12px; position:relative;}
    .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .card-title{font-weight:600}
    .iframe-full iframe{width:100%;height:520px;border:0;border-radius:8px;background:#fff}
    /* actions on cards */
    .actions{position:absolute; top:8px; right:10px; display:flex; gap:6px}
    .actions button, .actions a{font-size:12px; padding:4px 8px; border:1px solid var(--soft); border-radius:8px; background:#fff; color:#111827; text-decoration:none}
    /* per-region viewer */
    .controls{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin:8px 0 14px 0}
    @media (max-width:980px){.controls{grid-template-columns:1fr 1fr}}
    label{font-size:12px;color:var(--ink-2);display:block;margin-bottom:6px}
    select{width:100%;padding:10px;border:1px solid var(--soft);border-radius:10px;background:#fff}
    .img-panel{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    @media (max-width:980px){.img-panel{grid-template-columns:1fr}}
    .imgbox{background:var(--panel);border:1px solid var(--soft);border-radius:12px;padding:8px;text-align:center}
    .imgbox img{max-width:100%;height:auto;border-radius:8px}
    footer{padding:22px 0;color:var(--muted)}
    /* fullscreen overlay for iframes */
    #fsPanel{ position:fixed; inset:0; background:rgba(0,0,0,.75); display:none;
      align-items:center; justify-content:center; z-index:9999; }
    #fsPanel .frame{ width:95vw; height:90vh; background:#fff; border-radius:10px; border:0; }
    #fsPanel .close{ position:absolute; top:14px; right:18px; padding:6px 10px; background:#fff; border-radius:8px; border:1px solid var(--soft); }
  </style>
</head>
<body>
<header>
  <div class="wrap nav">
    <h1>Wildfire â€” GRU + Hazard RNN</h1>
    <nav>
      <ul>
        <li><a href="#findings">Main findings</a></li>
        <li><a href="#viewer">Perâ€‘region</a></li>
        <li><a href="#interactive">Interactive</a></li>
        <li><a href="#methods">Methods</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- ===== 1) Main findings (moved to top) ===== -->
  <section class="hero" id="findings">
    <h2>Main findings</h2>
    <p class="muted">
      æ—¥å°ºåº¦æ ¼ç‚¹ï¼ˆ10â€“15 kmÂ²ï¼‰ï¼Œhistoryâ€‘safe ç‰¹å¾ï¼›GRU é¢„æµ‹ <span class="pill">k=7</span><span class="pill">k=14</span> å¤©å†…æ˜¯å¦å‡ºç°æ–°ç«ï¼›
      å­¦åˆ°çš„ spatial ignition prior ä½œä¸ºæ—¶å˜ç‰¹å¾ï¼›postâ€‘fire reâ€‘ignition ç”¨ç¦»æ•£æ—¶é—´ hazardã€‚
    </p>
    <div class="grid cols-2">
      <div class="card">
        <div class="card-header"><div class="card-title">æ•´ä½“è¡¨ç°</div></div>
        <ul class="muted">
          <li>k=14 + prior åœ¨å¤šæ•° region ä¸Šæ ¡å‡†è‰¯å¥½ï¼›PR-AUCã€gain æ›²çº¿åœ¨ä¸­/é«˜ç«åŒºæ˜æ˜¾ä¼˜äºä½ç«åŒºã€‚</li>
          <li>å…¸å‹å¼ºåŒºï¼šWest_Mid, West_North, Coast_Mid, CentralWest_Mid+South_COMBINEDã€‚</li>
          <li>å¼±åŒºï¼šCentralWest_South, Midwest_South ç­‰ä½ç«åŒºï¼Œprecision è¾ƒä½ä¸”æ›²çº¿æ›´ noisyã€‚</li>
        </ul>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">Prior çš„å¢ç›Š</div></div>
        <ul class="muted">
          <li>k=14ï¼šwith_prior ç›¸æ¯” no_priorï¼ŒROC-AUC å¹³å‡ +0.02â€‰~â€‰+0.03ã€‚</li>
          <li>Topâ€‘3% precision åœ¨å¤§å¤šæ•° region æå‡ 0.03â€“0.08ï¼ˆå°‘æ•°ç•¥é™ï¼‰ã€‚</li>
        </ul>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">Topâ€‘3%ï¼ˆk=14, with_priorï¼‰</div></div>
        <ul class="muted">
          <li>å…¨åŒºåŸŸä¸­ä½ precision â‰ˆ 0.36ï¼›â‰ˆ42% çš„åœ°åŒº â‰¥ 0.40ï¼›â‰ˆ29% çš„åœ°åŒº â‰¥ 0.50ã€‚</li>
          <li>åœ¨æåº¦ä¸å¹³è¡¡ä¸‹ï¼Œå¾ˆå¤š region çš„ top slice ä»å…·å¤‡è¾ƒé«˜æ”¶ç›Šã€‚</li>
        </ul>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">Operating points</div></div>
        <ul class="muted">
          <li>k=14, with_priorï¼ŒåŒºåŸŸç‰¹å®šé˜ˆå€¼ï¼ˆç›®æ ‡ â‰ˆ30% precisionï¼‰ã€‚</li>
          <li>ä¸­/é«˜ç«åŒº precision ~ 0.30â€“0.45ï¼›lift é€šå¸¸ 1.5â€“3Ã— baseã€‚</li>
          <li>alerts_per_fire å¤šæ•°åœ°åŒº 2â€“3 æ¡/ç«ï¼›balanced accuracy ~ 0.55â€“0.65ã€‚</li>
        </ul>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">k=7 vs k=14</div></div>
        <ul class="muted">
          <li>ROCâ€‘AUC é«˜åº¦ç›¸å…³ï¼Œå¹³å‡å·®å¾ˆå°ï¼ˆk=14 ç•¥ä½ï¼‰ï¼›k=14 ä½œä¸ºä¸» horizonï¼Œk=7 ä¾›çŸ­æœŸå†³ç­–/é²æ£’æ€§æ£€éªŒã€‚</li>
        </ul>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">Hazardï¼ˆå†ç‚¹ç‡ƒï¼‰</div></div>
        <ul class="muted">
          <li>West_Midï¼šP(Tâ‰¤30) â‰ˆ 0.35ï¼ŒP(Tâ‰¤60) â‰ˆ 0.51ï¼Œreâ€‘ignition å¿«ï¼›å¤šæ•°å…¶ä»–åœ°åŒº P(Tâ‰¤60) çº¦ 0.10â€“0.25ã€‚</li>
          <li>ç”±æ­¤åˆ’åˆ† fast / mid / slow hazard tiersï¼šå¿«åŒºå¯è¾ƒé«˜è¦†ç›–ç‡ï¼Œæ…¢åŒºé€‚åˆè¾ƒä½ alert rate ä¸æ›´é•¿å†·å´æœŸã€‚</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ===== 2) Perâ€‘region diagnostics viewer ===== -->
  <section id="viewer">
    <h2>Perâ€‘region diagnostics viewer</h2>
    <p class="muted">é€‰æ‹© regionã€lat bandã€horizonã€æ˜¯å¦ä½¿ç”¨ spatial priorï¼›è‡ªåŠ¨åŠ è½½ä¸‰å¼ è¯Šæ–­å›¾ï¼šPR/ROC/æ ¡å‡†ã€score åˆ†å¸ƒã€gain & liftã€‚</p>

    <div class="controls">
      <div>
        <label for="region">Region</label>
        <select id="region"></select>
      </div>
      <div>
        <label for="lat">Lat zone</label>
        <select id="lat"></select>
      </div>
      <div>
        <label for="k">Horizon k</label>
        <select id="k">
          <option value="7">7</option>
          <option value="14" selected>14</option>
        </select>
      </div>
      <div>
        <label for="prior">Prior</label>
        <select id="prior">
          <option value="with_prior" selected>with spatial prior</option>
          <option value="no_prior">no prior</option>
        </select>
      </div>
    </div>

    <div class="small" id="hint"></div>

    <div class="img-panel">
      <div class="imgbox">
        <img id="imgA" alt="PR/ROC/Calibration plot" onerror="this.alt='æ‰¾ä¸åˆ°å›¾ç‰‡ï¼ˆPR/ROC/Calibrationï¼‰'; this.style.opacity=0.5;">
        <div class="small">PRâ€‘ROCâ€‘Reliability</div>
      </div>
      <div class="imgbox">
        <img id="imgB" alt="Score histogram" onerror="this.alt='æ‰¾ä¸åˆ°å›¾ç‰‡ï¼ˆscore histogramï¼‰'; this.style.opacity=0.5;">
        <div class="small">Score histogram</div>
      </div>
      <div class="imgbox">
        <img id="imgC" alt="Gain & Lift curves" onerror="this.alt='æ‰¾ä¸åˆ°å›¾ç‰‡ï¼ˆgain & liftï¼‰'; this.style.opacity=0.5;">
        <div class="small">Gain & lift</div>
      </div>
    </div>
  </section>

  <!-- ===== 3) Interactive summaries (moved after viewer; now 7 cards) ===== -->
  <section id="interactive">
    <h2>Interactive summaries</h2>
    <div class="grid cols-2">
      <div class="card">
        <div class="actions"><button type="button" data-fs="gru_pr_curves.html">ğŸ” æ”¾å¤§</button><a target="_blank" rel="noopener" href="gru_pr_curves.html">â†— æ–°æ ‡ç­¾</a></div>
        <div class="card-header"><div class="card-title">PR overlaysï¼ˆk=14, with priorï¼‰</div></div>
        <div class="iframe-full"><iframe src="gru_pr_curves.html" title="PR overlays (k=14 with prior)"></iframe></div>
      </div>

      <div class="card">
        <div class="actions"><button type="button" data-fs="gru_summary.html">ğŸ” æ”¾å¤§</button><a target="_blank" rel="noopener" href="gru_summary.html">â†— æ–°æ ‡ç­¾</a></div>
        <div class="card-header"><div class="card-title">Summary metricsï¼ˆPRâ€‘AUC / ROCâ€‘AUC / baseï¼‰</div></div>
        <div class="iframe-full"><iframe src="gru_summary.html" title="GRU summary table & charts"></iframe></div>
      </div>

      <div class="card">
        <div class="actions"><button type="button" data-fs="operating_points.html">ğŸ” æ”¾å¤§</button><a target="_blank" rel="noopener" href="operating_points.html">â†— æ–°æ ‡ç­¾</a></div>
        <div class="card-header"><div class="card-title">Operating pointsï¼ˆk=14 & k=7ï¼‰</div></div>
        <div class="iframe-full"><iframe src="operating_points.html" title="Operating points"></iframe></div>
      </div>

      <div class="card">
        <div class="actions"><button type="button" data-fs="delta_top3.html">ğŸ” æ”¾å¤§</button><a target="_blank" rel="noopener" href="delta_top3.html">â†— æ–°æ ‡ç­¾</a></div>
        <div class="card-header"><div class="card-title">Topâ€‘3% precision gainsï¼ˆwith vs no priorï¼‰</div></div>
        <div class="iframe-full"><iframe src="delta_top3.html" title="Top-3% precision gain"></iframe></div>
      </div>

      <div class="card">
        <div class="actions"><button type="button" data-fs="gain_overlay.html">ğŸ” æ”¾å¤§</button><a target="_blank" rel="noopener" href="gain_overlay.html">â†— æ–°æ ‡ç­¾</a></div>
        <div class="card-header"><div class="card-title">Gain overlay â€” coverage vs recall</div></div>
        <div class="iframe-full"><iframe src="gain_overlay.html" title="Gain overlay â€” coverage vs recall"></iframe></div>
      </div>

      <div class="card">
        <div class="actions"><button type="button" data-fs="hazard_waiting.html">ğŸ” æ”¾å¤§</button><a target="_blank" rel="noopener" href="hazard_waiting.html">â†— æ–°æ ‡ç­¾</a></div>
        <div class="card-header"><div class="card-title">Median interâ€‘fire waiting time</div></div>
        <div class="iframe-full"><iframe src="hazard_waiting.html" title="Median waiting time"></iframe></div>
      </div>

      <div class="card">
        <div class="actions"><button type="button" data-fs="hazard_cumprob.html">ğŸ” æ”¾å¤§</button><a target="_blank" rel="noopener" href="hazard_cumprob.html">â†— æ–°æ ‡ç­¾</a></div>
        <div class="card-header"><div class="card-title">Reâ€‘ignition probability â‰¤ 30/60 days</div></div>
        <div class="iframe-full"><iframe src="hazard_cumprob.html" title="Cumulative re-ignition probability"></iframe></div>
      </div>
    </div>
    <p class="small">è‹¥ iframe æœªæ˜¾ç¤ºï¼Œè¯·ç¡®è®¤è¿™äº› HTML ä½äºä»“åº“æ ¹ç›®å½•å¹¶ä¸æœ¬é¡µåŒæºï¼ˆGitHub Pages è‡ªåŠ¨æ»¡è¶³ï¼‰ã€‚</p>
  </section>

  <!-- ===== 4) Methods (summary) ===== -->
  <section id="methods">
    <h2>Methodsï¼ˆsummaryï¼‰</h2>
    <div class="card">
      <ul>
        <li>æ•°æ®ï¼šå›ºå®šæ ¼ç‚¹ï¼ˆ10â€“15 kmÂ²ï¼‰ï¼Œæ¯æ—¥ wildfire æŒ‡æ ‡ âˆˆ{0,1} + åŒæ—¥ç‰©ç† covariatesï¼ˆå¤©æ°”ã€fuelï¼‰ï¼Œå…¨é‡ features å‡ historyâ€‘safeã€‚</li>
        <li>ç‰¹å¾ï¼š1 æ—¥æ»åï¼›7â€“30 æ—¥æ»šåŠ¨å‡å€¼/å’Œ/æå€¼ï¼›30 æ—¥æ— é›¨è®¡æ•°ï¼›CatBoost ignition prior åŠå…¶è¡ç”Ÿï¼ˆlogitã€rankã€çŸ­æœŸ lagã€7 æ—¥æ»šåŠ¨ï¼‰ã€‚</li>
        <li>æ—¶åºï¼šexpanding windowï¼ˆ2013â€“2021 è®­ç»ƒï¼Œ2022 éªŒè¯ï¼Œ2023â€“2025 æµ‹è¯•ï¼‰ï¼›è·¨å¹´è¾¹ç•Œ Â±7 å¤©ç§»é™¤ï¼›éªŒè¯é›†åšæ¸©åº¦æ ¡å‡†ï¼ˆtemperature scalingï¼‰ã€‚</li>
        <li>GRUï¼šå•å±‚ + sigmoidï¼›ç›®æ ‡ <code>y_t^k = 1{ç«å‡ºç°åœ¨ [t+1,t+k]}</code>ï¼›æŸå¤± weighted BCEï¼›early stopping ä»¥ PRâ€‘AUCã€‚</li>
        <li>è¯„ä»·ï¼šPR/ROCã€Brier & BSSã€reliabilityã€gain/liftï¼›ä¸¤ç±»å†³ç­–ï¼šå›ºå®š precisionï¼ˆå¦‚ 30%ï¼‰æˆ– Topâ€‘Kï¼ˆ0.1â€“0.2% ç½‘æ ¼ï¼‰ã€‚</li>
        <li>Hazardï¼š3 å¤©å¹¶çª—ï¼ˆepisodeï¼‰ï¼›ç¦»æ•£æ—¶é—´ risk setï¼ˆregion Ã— lat_zone poolingï¼‰ï¼›è¾“å‡º <code>h(t), S(t), P(Tâ‰¤Â·)</code> ä¸ tier å¯¹æ¯”ã€‚</li>
      </ul>
      <p class="small">æ³¨ï¼šæ ¡å‡†åœ¨ 2022 ä¸Šæ‹Ÿåˆï¼ˆtemperature scalingï¼‰ï¼Œåœ¨ 2023â€“2025 ä¸Šè¯„ä¼°ï¼›
      <code>alerts_per_fire</code> å®šä¹‰ä¸ºæ•è·ä¸€åœºç«æ‰€éœ€ alerts æ¡æ•°ï¼ˆ= 1 / recall åœ¨æ‰€é€‰è¦†ç›–ç‡ä¸‹çš„è¿‘ä¼¼ï¼‰ã€‚</p>
    </div>
  </section>

  <footer>
    <p>Built for sta160â€‘wildfire Â· é™æ€æ–‡ä»¶å³å¯éƒ¨ç½²äº GitHub Pages</p>
  </footer>
</main>

<!-- fullscreen overlay panel -->
<div id="fsPanel">
  <button class="close">å…³é—­ Esc</button>
  <iframe class="frame"></iframe>
</div>

<noscript>éœ€è¦å¯ç”¨ JavaScript ä»¥ä½¿ç”¨ perâ€‘region è¯Šæ–­æµè§ˆå™¨ä¸æ”¾å¤§åŠŸèƒ½ã€‚</noscript>

<script>
/* ========== 1) REGION / LAT configï¼ˆä¸ä½ ä»“åº“ç›®å½•ä¸€è‡´ï¼‰ ========== */
const REGION_LAT_CONFIG = [
  // CentralWest
  {tag:"CentralWest_FarNorth", region:"CentralWest", lat:"FarNorth"},
  {tag:"CentralWest_Mid", region:"CentralWest", lat:"Mid"},
  {tag:"CentralWest_Mid+South_COMBINED", region:"CentralWest", lat:"Mid+South_COMBINED"},
  {tag:"CentralWest_North", region:"CentralWest", lat:"North"},
  {tag:"CentralWest_South", region:"CentralWest", lat:"South"},

  // Coast
  {tag:"Coast_FarNorth", region:"Coast", lat:"FarNorth"},
  {tag:"Coast_Mid", region:"Coast", lat:"Mid"},
  {tag:"Coast_North", region:"Coast", lat:"North"},
  {tag:"Coast_South", region:"Coast", lat:"South"},

  // East
  {tag:"East_FarNorth", region:"East", lat:"FarNorth"},
  {tag:"East_Mid", region:"East", lat:"Mid"},
  {tag:"East_North", region:"East", lat:"North"},
  {tag:"East_NorthBand_COMBINED", region:"East", lat:"NorthBand_COMBINED"},
  {tag:"East_South", region:"East", lat:"South"},

  // Midwest
  {tag:"Midwest_FarNorth", region:"Midwest", lat:"FarNorth"},
  {tag:"Midwest_Mid", region:"Midwest", lat:"Mid"},
  {tag:"Midwest_North", region:"Midwest", lat:"North"},
  {tag:"Midwest_South", region:"Midwest", lat:"South"},

  // NorthEast
  {tag:"NorthEast_FarNorth", region:"NorthEast", lat:"FarNorth"},
  {tag:"NorthEast_North", region:"NorthEast", lat:"North"},
  {tag:"NorthEast_NorthBand_COMBINED", region:"NorthEast", lat:"NorthBand_COMBINED"},

  // West
  {tag:"West_FarNorth", region:"West", lat:"FarNorth"},
  {tag:"West_Mid", region:"West", lat:"Mid"},
  {tag:"West_North", region:"West", lat:"North"}
];

/* ========== 2) ä¸‹æ‹‰å¡«å……ä¸å›¾ç‰‡è·¯å¾„ fallback é€»è¾‘ ========== */
const selRegion = document.getElementById('region');
const selLat    = document.getElementById('lat');
const selK      = document.getElementById('k');
const selPrior  = document.getElementById('prior');
const hint      = document.getElementById('hint');

function unique(arr){ return [...new Set(arr)]; }
function regions(){ return unique(REGION_LAT_CONFIG.map(x=>x.region)).sort(); }
function latsOf(region){ return REGION_LAT_CONFIG.filter(x=>x.region===region).map(x=>x.lat); }
function tagOf(region, lat){ const item = REGION_LAT_CONFIG.find(x=>x.region===region && x.lat===lat); return item ? item.tag : null; }

function fillRegions(){
  selRegion.innerHTML = regions().map(r=>`<option value="${r}">${r}</option>`).join('');
}
function fillLats(){
  const r = selRegion.value;
  const lats = unique(latsOf(r));
  selLat.innerHTML = lats.map(l=>`<option value="${l}">${l}</option>`).join('');
}

// å°è¯•å¤šç§è·¯å¾„/å‘½åï¼ˆå¹³é“ºã€åµŒå¥—ã€ç©ºæ ¼/åˆå¹¶å¸¦å˜ä½“ï¼‰
function buildCandidates(tag, k, pr, plot){
  const flat   = `figs/gru_region/${tag}_k${k}_GRU_${pr}_${plot}.png`;
  const nested = `figs/gru_region/${tag}/figs/${tag}_k${k}_GRU_${pr}_${plot}.png`;

  const tagSpace = tag.replace('FarNorth','Far North');
  const flatSpace   = `figs/gru_region/${tagSpace}_k${k}_GRU_${pr}_${plot}.png`;
  const nestedSpace = `figs/gru_region/${tagSpace}/figs/${tagSpace}_k${k}_GRU_${pr}_${plot}.png`;

  const tagBand = tag.replace('_NorthBand_COMBINED','_NorthBand');
  const flatBand   = `figs/gru_region/${tagBand}_k${k}_GRU_${pr}_${plot}.png`;
  const nestedBand = `figs/gru_region/${tagBand}/figs/${tagBand}_k${k}_GRU_${pr}_${plot}.png`;

  return [flat, nested, flatSpace, nestedSpace, flatBand, nestedBand];
}
function setWithFallback(img, urls){
  if(!urls.length){ img.alt='æ‰¾ä¸åˆ°å›¾ç‰‡'; img.style.opacity=0.5; return; }
  const url = urls.shift();
  img.onerror = ()=>{ setWithFallback(img, urls); };
  console.log('[viewer] try:', url);
  img.src = url;
}
function updateImages(){
  const tag = tagOf(selRegion.value, selLat.value);
  const k   = selK.value;
  const pr  = selPrior.value;
  const plots = ['pr_roc_reliability','score_hist','gain_lift'];
  const ids   = ['imgA','imgB','imgC'];
  plots.forEach((plot, i)=>{
    const urls = buildCandidates(tag, k, pr, plot);
    setWithFallback(document.getElementById(ids[i]), urls);
  });
  hint.textContent = `å½“å‰ï¼š${tag} Â· k=${k} Â· ${pr}ï¼ˆè‡ªåŠ¨å¤šè·¯å¾„åŒ¹é…ï¼‰`;
}

// åˆå§‹åŒ–é»˜è®¤é¡¹
fillRegions();
selRegion.value = "West";
fillLats();
selLat.value = "Mid";
updateImages();

[selRegion, selLat, selK, selPrior].forEach(el=>{
  el.addEventListener('change', ()=>{
    if(el===selRegion){ fillLats(); }
    updateImages();
  });
});

/* ========== 3) äº¤äº’å¡ç‰‡ï¼šæ”¾å¤§/æ–°æ ‡ç­¾æ‰“å¼€ ========== */
(function(){
  const panel = document.getElementById('fsPanel');
  const frame = panel.querySelector('.frame');
  function openFs(src){ frame.src = src; panel.style.display='flex'; }
  function closeFs(){ frame.src='about:blank'; panel.style.display='none'; }
  panel.querySelector('.close').onclick = closeFs;
  document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeFs(); });

  document.querySelectorAll('.actions [data-fs]').forEach(btn=>{
    btn.addEventListener('click', ()=> openFs(btn.getAttribute('data-fs')));
  });
})();
</script>
</body>
</html>
